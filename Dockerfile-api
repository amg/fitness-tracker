# Official Golang image https://hub.docker.com/_/golang
FROM golang:1.23

# Working directory
WORKDIR /app

# Copy everything at /app
COPY ./api /app

ARG SECRETS_PATH
ENV SECRETS_PATH=${SECRETS_PATH}

# need secrets
COPY ${SECRETS_PATH}* /app/.secrets

# secure variables for dev env
ARG FILE_KEY_PRIVATE
ENV FILE_KEY_PRIVATE=$FILE_KEY_PRIVATE

ARG FILE_KEY_PUBLIC
ENV FILE_KEY_PUBLIC=$FILE_KEY_PUBLIC

ARG POSTGRES_DBNAME
ENV POSTGRES_DBNAME=$POSTGRES_DBNAME

ARG POSTGRES_USER
ENV POSTGRES_USER=$POSTGRES_USER

ARG POSTGRES_PASSWORD
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD

ARG POSTGRES_URL
ENV POSTGRES_URL=$POSTGRES_URL
# endregion

ARG ENV
ENV ENV=${ENV}

ARG GOOGLE_PROJECT_ID
ENV GOOGLE_PROJECT_ID=$GOOGLE_PROJECT_ID

ARG GOOGLE_CLIENT_ID
ENV GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID

ARG GOOGLE_CLIENT_SECRET
ENV GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET

ARG GOOGLE_CLIENT_CALLBACK_URL
ENV GOOGLE_CLIENT_CALLBACK_URL=$GOOGLE_CLIENT_CALLBACK_URL

ARG API_PORT
ENV API_PORT=$API_PORT

ARG COOKIE_DOMAIN
ENV COOKIE_DOMAIN=$COOKIE_DOMAIN

ARG WEB_BASE_URL
ENV WEB_BASE_URL=$WEB_BASE_URL

# Build the go app
RUN go build -o main .

# Define the command to run the app
CMD ["./main"]
